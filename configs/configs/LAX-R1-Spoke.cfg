!===========================
! LAX-R1 (Spoke - Los Angeles) - CSR1000v
! Enterprise Hub-and-Spoke IPSec VPN Lab
!===========================
hostname LAX-R1
enable secret Cisco123!
username admin privilege 15 secret Admin123!
service password-encryption
!
! IMPROVEMENT: Loopback for OSPF Router-ID Stability
interface Loopback0
 description OSPF Router-ID Interface
 ip address 2.2.2.2 255.255.255.255
 no shutdown
!
! IMPROVEMENT: Consistent IKEv2 with Enhanced Crypto
crypto ikev2 proposal IKEv2_PROPOSAL
 encryption aes-gcm-256
 integrity sha384
 group 16
!
crypto ikev2 policy IKEv2_POLICY
 proposal IKEv2_PROPOSAL
!
crypto ikev2 keyring IKEv2_KEYRING
 peer HUB
  address 198.51.100.10
  pre-shared-key [REPLACE_WITH_LAX_PSK]
!
! IMPROVEMENT: DPD for Better Reliability
crypto ikev2 profile IKEv2_PROFILE
 match identity remote address 198.51.100.10 255.255.255.255
 authentication remote pre-share
 authentication local pre-share
 keyring local IKEv2_KEYRING
 dpd 10 3 periodic
!
! IMPROVEMENT: Enhanced IPSec with AES-GCM
crypto ipsec transform-set VPN_SET esp-gcm 256
 mode tunnel
!
crypto ipsec profile VPN_PROFILE
 set transform-set VPN_SET
 set pfs group16
 set ikev2-profile IKEv2_PROFILE
!
! WAN Interface
interface GigabitEthernet1
 description WAN to ISP
 ip address 203.0.113.25 255.255.255.128
 ip nat outside
 no shutdown
!
! LAN Interface  
interface GigabitEthernet2
 description LAN Interface
 ip address 10.2.0.1 255.255.0.0
 ip nat inside
 no shutdown
!
! PRIMARY VPN Tunnel
interface Tunnel10
 description Primary VPN to Hub DAL
 ip address 172.16.0.2 255.255.255.252
 tunnel source GigabitEthernet1
 tunnel destination 198.51.100.10
 tunnel mode ipsec ipv4
 tunnel protection ipsec profile VPN_PROFILE
 keepalive 30 3
 bandwidth 100000
 service-policy output VPN_QOS_POLICY
 no shutdown
!
! BACKUP VPN Tunnel
interface Tunnel11
 description Backup VPN to Hub DAL via ISP2
 ip address 172.16.1.2 255.255.255.252
 tunnel source GigabitEthernet1
 tunnel destination 203.0.114.10
 tunnel mode ipsec ipv4
 tunnel protection ipsec profile VPN_PROFILE
 keepalive 30 3
 bandwidth 100000
 shutdown
!
! QoS Policy for VPN
class-map match-all VOICE_TRAFFIC
 match dscp ef
!
class-map match-all VIDEO_TRAFFIC
 match dscp af41
!
policy-map VPN_QOS_POLICY
 class VOICE_TRAFFIC
  priority percent 20
 class VIDEO_TRAFFIC
  bandwidth percent 30
 class class-default
  fair-queue
!
! IMPROVEMENT: OSPF with Loopback Router-ID for Stability
router ospf 1
 router-id 2.2.2.2
 network 2.2.2.2 0.0.0.0 area 0
 network 10.2.0.0 0.0.255.255 area 0
 network 172.16.0.0 0.0.0.252 area 0
 network 172.16.1.0 0.0.0.252 area 0
!
! NAT for internet access
ip access-list extended NAT_ACL
 deny ip 10.0.0.0 0.255.255.255 10.0.0.0 0.255.255.255
 permit ip 10.0.0.0 0.255.255.255 any
!
ip nat inside source list NAT_ACL interface GigabitEthernet1 overload
!
! SLA Monitoring for Tunnel Health
ip sla 10
 icmp-echo 172.16.0.1 source-interface Tunnel10
 frequency 30
 timeout 5000
!
ip sla schedule 10 life forever start-time now
!
track 10 ip sla 10 reachability
!
! Basic management
line vty 0 4
 login local
 transport input ssh
line con 0
 logging synchronous
